<app-layout>
  <!-- TODO: extraer strings de esta pantalla -->
  <h1>
    <ng-container *ngIf="newDrawing; else titleEditForm">
      {{ text('TITLE.CREATE') | mrTranslate }}
    </ng-container>
    <ng-template #titleEditForm>
      {{ text('TITLE.EDIT') | mrTranslate: { id: drawing.id } }}
    </ng-template>
  </h1>
  <form
    class="grid grid-cols-1 gap-4"
    (submit)="saveDrawing()"
    [formGroup]="form">
    <app-text-input
      *ngIf="newDrawing; else idEdit"
      formControlName="id"
      (change)="checkDrawingId($event)"
      [placeholder]="text('FORM.ID.PLACEHOLDER') | mrTranslate"
      [label]="text('FORM.ID.TITLE') | mrTranslate">
    </app-text-input>

    <ng-template #idEdit>
      <span>{{ drawing.id }}</span>
    </ng-template>
    <p *ngIf="duplicateId">
      {{
        text('ERRORS.DUPLICATE-ID') | mrTranslate: { id: this.form.value.id }
      }}
    </p>

    <app-text-input
      formControlName="path"
      (change)="checkAzurePath($event)"
      [placeholder]="text('FORM.PATH.PLACEHOLDER') | mrTranslate"
      [label]="text('FORM.PATH.TITLE') | mrTranslate">
    </app-text-input>

    <app-text-input
      formControlName="title"
      [placeholder]="text('FORM.TITLE.PLACEHOLDER') | mrTranslate"
      [label]="text('FORM.TITLE.TITLE') | mrTranslate">
    </app-text-input>

    <app-switch
      [text]="text('FORM.FAVORITE.TITLE') | mrTranslate"
      [formControl]="form.controls.favorite">
    </app-switch>

    <!-- <app-setting-section [title]="text('SECTIONS.NAMES') | mrTranslate"> -->
    <app-text-input
      formControlName="name"
      [placeholder]="text('FORM.NAME.PLACEHOLDER') | mrTranslate"
      [label]="text('FORM.NAME.TITLE') | mrTranslate">
    </app-text-input>

    <app-text-input
      formControlName="modelName"
      [placeholder]="text('FORM.MODEL-NAME.PLACEHOLDER') | mrTranslate"
      [label]="text('FORM.MODEL-NAME.TITLE') | mrTranslate">
    </app-text-input>
    <!-- </app-setting-section> -->

    <app-select-input [options]="listDrawingStyles" formControlName="type">
    </app-select-input>

    <app-select-input
      [firstOption]="{
        value: '0',
        label: '',
        labelCode: 'SCREENS.DRAWING-SEARCH.FORM.SOFTWARE.TITLE',
      }"
      [options]="listDrawingSoftwares"
      formControlName="software">
    </app-select-input>

    <app-select-input
      [firstOption]="{
        value: '0',
        label: '',
        labelCode: 'SCREENS.DRAWING-SEARCH.FORM.PAPER.TITLE',
      }"
      [options]="listDrawingPapers"
      formControlName="paper">
    </app-select-input>

    <app-date-input
      formControlName="dateHyphen"
      [label]="text('FORM.DATE.TITLE') | mrTranslate">
    </app-date-input>

    <app-text-input
      type="number"
      [min]="1"
      [max]="100"
      formControlName="scoreCritic"
      [placeholder]="text('FORM.SCORE-CRITIC.PLACEHOLDER') | mrTranslate"
      [label]="text('FORM.SCORE-CRITIC.TITLE') | mrTranslate">
    </app-text-input>

    <app-drawing-score [score]="form.value.scoreCritic ?? 0">
    </app-drawing-score>

    <app-text-input
      type="number"
      [min]="0"
      formControlName="time"
      [placeholder]="text('FORM.TIME.PLACEHOLDER') | mrTranslate"
      [label]="'TIME'">
    </app-text-input>
    <!-- TODO: aÃ±adir calculo de horas a las que equivale los minutos -->

    <app-select-input
      [firstOption]="{
        value: '-1',
        label: '',
        labelCode: 'SCREENS.DRAWING-SEARCH.FORM.PRODUCT-TYPE.TITLE',
      }"
      [options]="listDrawingProductTypes"
      formControlName="productType">
    </app-select-input>

    <app-text-input
      formControlName="productName"
      [placeholder]="text('FORM.PRODUCT.PLACEHOLDER') | mrTranslate"
      [label]="text('FORM.PRODUCT.TITLE') | mrTranslate">
    </app-text-input>

    <app-drawing-form-comments
      [formArrayName]="'listComments'"
      [formArray]="listComments"
      [comments]="drawing.listComments"
      [label]="text('FORM.COMMENTS.TITLE') | mrTranslate"
      [placeholder]="text('FORM.COMMENTS.PLACEHOLDER') | mrTranslate">
    </app-drawing-form-comments>

    <app-drawing-form-comments
      [formArrayName]="'listCommentPros'"
      [formArray]="listCommentPros"
      [comments]="drawing.listCommentPros"
      [label]="text('FORM.COMMENTS-PROS.TITLE') | mrTranslate"
      [placeholder]="text('FORM.COMMENTS-PROS.PLACEHOLDER') | mrTranslate">
    </app-drawing-form-comments>

    <app-drawing-form-comments
      [formArrayName]="'listCommentCons'"
      [formArray]="listCommentCons"
      [comments]="drawing.listCommentCons"
      [label]="text('FORM.COMMENTS-CONS.TITLE') | mrTranslate"
      [placeholder]="text('FORM.COMMENTS-CONS.PLACEHOLDER') | mrTranslate">
    </app-drawing-form-comments>

    <app-text-input
      formControlName="tagsText"
      [placeholder]="text('FORM.TAGS.PLACEHOLDER') | mrTranslate"
      [label]="text('FORM.TAGS.TITLE') | mrTranslate">
    </app-text-input>

    <app-text-input
      formControlName="referenceUrl"
      [placeholder]="text('FORM.REFERENCE.PLACEHOLDER') | mrTranslate"
      [label]="text('FORM.REFERENCE.TITLE') | mrTranslate">
    </app-text-input>

    <app-text-input
      formControlName="spotifyUrl"
      [placeholder]="text('FORM.SPOTIFY.PLACEHOLDER') | mrTranslate"
      [label]="text('FORM.SPOTIFY.TITLE') | mrTranslate">
    </app-text-input>

    <button
      *ngIf="validForm"
      [disabled]="duplicateId"
      class="btn"
      type="submit">
      <ng-container *ngIf="newDrawing; else btnSaveEditForm">
        {{ text('FORM.SAVE.CREATE') | mrTranslate }}
      </ng-container>
      <ng-template #btnSaveEditForm>
        {{ text('FORM.SAVE.EDIT') | mrTranslate: { id: drawing.id } }}
      </ng-template>
    </button>
  </form>

  <!-- TODO: llevar esto al Art/Edit component -->
  <div *ngIf="drawingNotFound" class="flex flex-col flex-nowrap gap-3">
    <h1>
      {{ text('NOTFOUND.TITLE') | mrTranslate }}
    </h1>
    <h3>
      {{ text('NOTFOUND.SUBTITLE') | mrTranslate: { id: drawing.id } }}
    </h3>
    <a routerLink="/art">
      {{ text('NOTFOUND.GO-TO-GALLERY') | mrTranslate }}
    </a>
  </div>
</app-layout>
